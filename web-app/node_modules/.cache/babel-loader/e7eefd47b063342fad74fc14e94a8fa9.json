{"remainingRequest":"/root/lockhash/web-app/node_modules/thread-loader/dist/cjs.js!/root/lockhash/web-app/node_modules/babel-loader/lib/index.js!/root/lockhash/web-app/node_modules/cache-loader/dist/cjs.js??ref--0-0!/root/lockhash/web-app/node_modules/vue-loader/lib/index.js??vue-loader-options!/root/lockhash/web-app/src/modules/threads/show.vue?vue&type=script&lang=js&","dependencies":[{"path":"/root/lockhash/web-app/src/modules/threads/show.vue","mtime":1553930101455},{"path":"/root/lockhash/web-app/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/root/lockhash/web-app/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/root/lockhash/web-app/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/root/lockhash/web-app/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/root/lockhash/web-app/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _objectSpread from \"/root/lockhash/web-app/node_modules/@babel/runtime-corejs2/helpers/esm/objectSpread\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport moment from 'moment';\nimport MedalIcon from '$icons/Medal';\nimport LockIcon from '$icons/LockAlert';\nimport TopIcon from '$icons/FormatVerticalAlignTop';\nimport PencilIcon from '$icons/Pencil';\nimport DeleteIcon from '$icons/Delete';\nimport AlertBoxIcon from '$icons/AlertBox';\nimport UserMedia from '$components/user-media';\nimport HotTags from '$components/hot-tags';\nimport UserListCard from '$components/user-list-card';\nimport WechatQrcode from '$components/wechat-qrcode';\nimport Comments from '$components/comments';\nimport StarIcon from '$icons/Star';\nimport MoreIcon from '$icons/DotsHorizontal';\nimport ShareIcon from '$icons/Share';\nimport SubscribeBtn from '$components/buttons/subscribe-btn';\nimport FollowBtn from '$components/buttons/follow-btn';\nimport LikeBtn from '$components/buttons/like-btn';\nimport MarkdownBody from '$components/markdown-body';\nimport ReportForm from './report-form';\nimport AnimateAction from '$components/buttons/animate-action';\nimport ShareAction from '$components/buttons/share-action';\nimport UserProfileCard from '$components/user-profile-card';\nimport ShareDropdown from '$components/share-dropdown';\nimport CommentIcon from '$icons/Comment';\nimport ViewIcon from '$icons/Eye';\nimport { mapGetters } from 'vuex';\nexport default {\n  components: {\n    UserListCard: UserListCard,\n    LikeBtn: LikeBtn,\n    AnimateAction: AnimateAction,\n    ShareAction: ShareAction,\n    ReportForm: ReportForm,\n    SubscribeBtn: SubscribeBtn,\n    CommentIcon: CommentIcon,\n    ViewIcon: ViewIcon,\n    FollowBtn: FollowBtn,\n    UserMedia: UserMedia,\n    HotTags: HotTags,\n    PencilIcon: PencilIcon,\n    AlertBoxIcon: AlertBoxIcon,\n    DeleteIcon: DeleteIcon,\n    ShareIcon: ShareIcon,\n    StarIcon: StarIcon,\n    MoreIcon: MoreIcon,\n    MedalIcon: MedalIcon,\n    TopIcon: TopIcon,\n    LockIcon: LockIcon,\n    MarkdownBody: MarkdownBody,\n    Comments: Comments,\n    UserProfileCard: UserProfileCard,\n    ShareDropdown: ShareDropdown,\n    WechatQrcode: WechatQrcode\n  },\n  data: function data() {\n    return {\n      thread: null,\n      showReportForm: false\n    };\n  },\n  computed: _objectSpread({}, mapGetters(['currentUser']), {\n    canEdit: function canEdit() {\n      return this.thread.user_id === this.$user().id || this.$user().is_admin;\n    }\n  }),\n  beforeRouteUpdate: function beforeRouteUpdate(to, from, next) {\n    if (to.params.id !== from.params.id) {\n      this.loadThread();\n    }\n\n    next();\n  },\n  methods: {\n    loadThread: function loadThread() {\n      var _this = this;\n\n      this.$http.get(\"threads/\".concat(this.$route.params.id, \"?include=user,likers\")).then(function (response) {\n        return _this.thread = response;\n      }).then(this.registerEventListener).catch(function (response) {\n        if (response.status === 404) {\n          _this.$message.error('该主题已被删除或锁定！');\n\n          setTimeout(function () {\n            _this.$router.go(-1);\n          }, 1000);\n        }\n      }).then(function () {\n        window.pageUsers = [_this.thread.user];\n      });\n    },\n    handleDelete: function handleDelete(thread) {\n      var _this2 = this;\n\n      this.$http.delete(\"threads/\".concat(thread.id)).then(function () {\n        _this2.$message.success('已删除！');\n\n        _this2.$router.go(-1);\n      });\n    },\n    toggleStatus: function toggleStatus(timestamp) {\n      var _this3 = this;\n\n      this.thread[timestamp] = this.thread[timestamp] ? null : moment().format('YYYY-MM-DD HH:mm:ss');\n      this.$http.patch(\"threads/\".concat(this.thread.id), this.thread).then(function () {\n        _this3.$message.success('搞定！');\n\n        _this3.loadThread();\n      });\n    }\n  },\n  mounted: function mounted() {\n    this.loadThread();\n  }\n};",{"version":3,"sources":["show.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div class=\"page-threads-show pb-4\" v-if=\"thread\">\n    <div class=\"row\">\n      <div class=\"col-md-9\">\n        <article class=\"box box-flush\">\n          <header class=\"thread-header box-body d-flex justify-content-between align-items-center\">\n            <user-media :user=\"thread.user\">\n              <small class=\"text-muted\" slot=\"description\">发布于 {{ thread.created_at_timeago }}</small>\n            </user-media>\n          </header>\n          <div class=\"thread-content box-body text-gray-40 text-16\">\n            <header>\n              <h2 class=\"mb-3 pb-2 border-bottom\">{{ thread.title }}</h2>\n            </header>\n            <markdown-body v-model=\"thread.content.body\"></markdown-body>\n          </div>\n          <div class=\"thread-stats-bar bg-white border-top py-1\">\n            <div class=\"container\">\n              <ul class=\"nav align-items-center\">\n                <li class=\"nav-item\">\n                  <like-btn relation=\"thread\" :item=\"thread\"></like-btn>\n                </li>\n                <li class=\"nav-item\">\n                  <a class=\"text-gray-50 btn btn-sm btn-link\" href=\"#comments\">\n                    <comment-icon></comment-icon>\n                    {{ thread.cache.comments_count }} 条评论\n                  </a>\n                </li>\n                <li class=\"nav-item\">\n                  <share-dropdown>\n                    <a class=\"text-gray-50 btn btn-sm btn-link\">\n                      <share-icon></share-icon>分享\n                    </a>\n                  </share-dropdown>\n                </li>\n                <li class=\"nav-item\">\n                  <button\n                    type=\"button\"\n                    class=\"text-gray-50 btn btn-sm btn-link\"\n                    data-toggle=\"dropdown\"\n                    aria-haspopup=\"true\"\n                    aria-expanded=\"false\"\n                  >\n                    <more-icon></more-icon>\n                  </button>\n                  <div class=\"dropdown-menu\">\n                    <template v-if=\"canEdit\">\n                      <template v-if=\"currentUser.is_admin\">\n                        <button\n                          class=\"dropdown-item\"\n                          type=\"button\"\n                          @click=\"toggleStatus('excellent_at')\"\n                        >\n                          <medal-icon class=\"mr-1\"></medal-icon>\n                          {{ thread.excellent_at ? '取消精华' : '精华' }}\n                        </button>\n                        <button\n                          class=\"dropdown-item\"\n                          type=\"button\"\n                          @click=\"toggleStatus('pinned_at')\"\n                        >\n                          <top-icon class=\"mr-1\"></top-icon>\n                          {{ thread.pinned_at ? '取消置顶' : '置顶' }}\n                        </button>\n                        <button\n                          class=\"dropdown-item\"\n                          type=\"button\"\n                          @click=\"toggleStatus('banned_at')\"\n                        >\n                          <lock-icon class=\"mr-1\"></lock-icon>\n                          {{ thread.banned_at ? '取消冻结' : '冻结' }}\n                        </button>\n                      </template>\n                      <button\n                        class=\"dropdown-item\"\n                        type=\"button\"\n                        @click=\"$router.push({name:'threads.edit', params:{id: thread.id}})\"\n                      >\n                        <pencil-icon class=\"mr-1\"></pencil-icon>编辑\n                      </button>\n                      <button\n                        class=\"dropdown-item text-danger\"\n                        type=\"button\"\n                        @click=\"handleDelete(thread)\"\n                      >\n                        <delete-icon class=\"mr-1\"></delete-icon>删除\n                      </button>\n                    </template>\n                    <button\n                      class=\"dropdown-item cursor-pointer\"\n                      type=\"button\"\n                      @click=\"showReportForm = true\"\n                    >\n                      <alert-box-icon class=\"mr-1\"></alert-box-icon>举报\n                    </button>\n                  </div>\n                </li>\n                <li class=\"nav-item ml-auto\">\n                  <subscribe-btn relation=\"thread\" :item=\"thread\"/>\n                </li>\n              </ul>\n            </div>\n          </div>\n          <div class=\"thread-author-card border-top p-3\">\n            <div class=\"d-flex align-items-center justify-content-between\">\n              <div class=\"user-info d-flex align-items-center\">\n                <router-link :to=\"{name: 'users.show', params: {username: thread.user.username}}\">\n                  <img :src=\"thread.user.avatar\" alt=\"User avatar\" class=\"avatar-60\">\n                </router-link>\n                <div class=\"p-2\">\n                  <router-link :to=\"{name: 'users.show', params: {username: thread.user.username}}\">\n                    <h3 class=\"text-gray-50 text-14\">{{ thread.user.name }}</h3>\n                  </router-link>\n                  <div class=\"text-12 text-muted\">{{ thread.user.bio }}</div>\n                </div>\n              </div>\n              <div class=\"right-action\">\n                <follow-btn :item=\"thread.user\"></follow-btn>\n              </div>\n            </div>\n          </div>\n        </article>\n        <div class=\"thread-comments mt-3\">\n          <comments object-type=\"App\\Thread\" :object-id=\"thread.id\" @created=\"loadThread\"></comments>\n        </div>\n        <div class=\"thread-toolbar\">\n          <animate-action :item=\"thread\"/>\n          <share-action class=\"mt-3\" :item=\"thread\"/>\n        </div>\n      </div>\n      <div class=\"col-md-3 position-relative\">\n        <user-profile-card class=\"user-profile-card\" :user=\"thread.user\"></user-profile-card>\n        <user-list-card title=\"他们觉得很赞\" :users=\"thread.likers\" class=\"mt-2\"/>\n        <hot-tags class=\"mt-2\"></hot-tags>\n      </div>\n    </div>\n    <wechat-qrcode/>\n    <report-form :visible=\"showReportForm\" @close=\"showReportForm = false\"/>\n  </div>\n</template>\n\n<script>\nimport moment from 'moment'\nimport MedalIcon from '$icons/Medal'\nimport LockIcon from '$icons/LockAlert'\nimport TopIcon from '$icons/FormatVerticalAlignTop'\nimport PencilIcon from '$icons/Pencil'\nimport DeleteIcon from '$icons/Delete'\nimport AlertBoxIcon from '$icons/AlertBox'\nimport UserMedia from '$components/user-media'\nimport HotTags from '$components/hot-tags'\nimport UserListCard from '$components/user-list-card'\nimport WechatQrcode from '$components/wechat-qrcode'\nimport Comments from '$components/comments'\nimport StarIcon from '$icons/Star'\nimport MoreIcon from '$icons/DotsHorizontal'\nimport ShareIcon from '$icons/Share'\nimport SubscribeBtn from '$components/buttons/subscribe-btn'\nimport FollowBtn from '$components/buttons/follow-btn'\nimport LikeBtn from '$components/buttons/like-btn'\nimport MarkdownBody from '$components/markdown-body'\nimport ReportForm from './report-form'\nimport AnimateAction from '$components/buttons/animate-action'\nimport ShareAction from '$components/buttons/share-action'\nimport UserProfileCard from '$components/user-profile-card'\nimport ShareDropdown from '$components/share-dropdown'\n\nimport CommentIcon from '$icons/Comment'\nimport ViewIcon from '$icons/Eye'\n\nimport { mapGetters } from 'vuex'\n\nexport default {\n  components: {\n    UserListCard,\n    LikeBtn,\n    AnimateAction,\n    ShareAction,\n    ReportForm,\n    SubscribeBtn,\n    CommentIcon,\n    ViewIcon,\n    FollowBtn,\n    UserMedia,\n    HotTags,\n    PencilIcon,\n    AlertBoxIcon,\n    DeleteIcon,\n    ShareIcon,\n    StarIcon,\n    MoreIcon,\n    MedalIcon,\n    TopIcon,\n    LockIcon,\n    MarkdownBody,\n    Comments,\n    UserProfileCard,\n    ShareDropdown,\n    WechatQrcode\n  },\n  data () {\n    return {\n      thread: null,\n      showReportForm: false\n    }\n  },\n  computed: {\n    ...mapGetters(['currentUser']),\n    canEdit () {\n      return this.thread.user_id === this.$user().id || this.$user().is_admin\n    }\n  },\n  beforeRouteUpdate (to, from, next) {\n    if (to.params.id !== from.params.id) {\n      this.loadThread()\n    }\n\n    next()\n  },\n  methods: {\n    loadThread () {\n      this.$http\n        .get(`threads/${this.$route.params.id}?include=user,likers`)\n        .then(response => (this.thread = response))\n        .then(this.registerEventListener)\n        .catch(response => {\n          if (response.status === 404) {\n            this.$message.error('该主题已被删除或锁定！')\n            setTimeout(() => {\n              this.$router.go(-1)\n            }, 1000)\n          }\n        })\n        .then(() => {\n          window.pageUsers = [this.thread.user]\n        })\n    },\n    handleDelete (thread) {\n      this.$http.delete(`threads/${thread.id}`).then(() => {\n        this.$message.success('已删除！')\n        this.$router.go(-1)\n      })\n    },\n    toggleStatus (timestamp) {\n      this.thread[timestamp] = this.thread[timestamp]\n        ? null\n        : moment().format('YYYY-MM-DD HH:mm:ss')\n      this.$http.patch(`threads/${this.thread.id}`, this.thread).then(() => {\n        this.$message.success('搞定！')\n        this.loadThread()\n      })\n    }\n  },\n  mounted () {\n    this.loadThread()\n  }\n}\n</script>\n\n<style lang=\"scss\">\n.thread-toolbar {\n  position: fixed;\n  top: 150px;\n  margin-left: -80px;\n}\n.thread-stats-bar {\n  position: sticky;\n  bottom: 0;\n  width: 100%;\n  left: 0;\n  .material-design-icon {\n    font-size: 1.2em;\n    bottom: -0.06em;\n  }\n}\n.user-profile-card {\n  position: sticky;\n  top: 20px;\n}\n\n@media screen and (min-width: 1200px) and (max-width: 1350px) {\n  .page-threads-show {\n    margin-left: 65px;\n  }\n}\n</style>\n"],"sourceRoot":"src/modules/threads"}]}
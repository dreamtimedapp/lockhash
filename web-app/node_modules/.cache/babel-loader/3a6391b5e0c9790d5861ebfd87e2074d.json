{"remainingRequest":"/root/lockhash/web-app/node_modules/thread-loader/dist/cjs.js!/root/lockhash/web-app/node_modules/babel-loader/lib/index.js!/root/lockhash/web-app/node_modules/cache-loader/dist/cjs.js??ref--0-0!/root/lockhash/web-app/node_modules/vue-loader/lib/index.js??vue-loader-options!/root/lockhash/web-app/src/modules/users/show.vue?vue&type=script&lang=js&","dependencies":[{"path":"/root/lockhash/web-app/src/modules/users/show.vue","mtime":1553930101455},{"path":"/root/lockhash/web-app/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/root/lockhash/web-app/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/root/lockhash/web-app/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/root/lockhash/web-app/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/root/lockhash/web-app/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/es6.regexp.replace\";\nimport \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"/root/lockhash/web-app/node_modules/@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _objectSpread from \"/root/lockhash/web-app/node_modules/@babel/runtime-corejs2/helpers/esm/objectSpread\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport moment from 'moment';\nimport { mapGetters } from 'vuex';\nimport HotTags from '$components/hot-tags';\nimport UserRanking from '$components/user-ranking';\nimport NewUsers from '$components/new-users';\nimport FollowBtn from '$components/buttons/follow-btn';\nimport MapMarkerIcon from '$icons/MapMarker';\nimport DomainIcon from '$icons/Domain';\nimport LinkIcon from '$icons/Link';\nimport AccountOffIcon from '$icons/AccountOff';\nimport CalendarCheckIcon from '$icons/CalendarCheck';\nimport AdminIcon from '$icons/AccountTie';\nimport UserSocialBtns from '$components/user-social-btns';\nimport UserLocked from '$components/user-locked';\nexport default {\n  name: 'show',\n  components: {\n    UserLocked: UserLocked,\n    FollowBtn: FollowBtn,\n    DomainIcon: DomainIcon,\n    CalendarCheckIcon: CalendarCheckIcon,\n    LinkIcon: LinkIcon,\n    AdminIcon: AdminIcon,\n    AccountOffIcon: AccountOffIcon,\n    MapMarkerIcon: MapMarkerIcon,\n    HotTags: HotTags,\n    UserRanking: UserRanking,\n    NewUsers: NewUsers,\n    UserSocialBtns: UserSocialBtns\n  },\n  data: function data() {\n    return {\n      user: {},\n      navFixed: false\n    };\n  },\n  computed: _objectSpread({}, mapGetters(['currentUser'])),\n  beforeRouteUpdate: function beforeRouteUpdate(to, from, next) {\n    if (to.params.username !== from.params.username) {\n      this.getUser(to.params.username);\n    }\n\n    next();\n  },\n  created: function created() {\n    this.getUser(this.$route.params.username);\n    this.$nextTick(this.registerEventListener);\n  },\n  methods: {\n    getUser: function () {\n      var _getUser = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee(username) {\n        var _this = this;\n\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                username = username || this.$route.params.username;\n                _context.next = 3;\n                return this.$http.get(\"users/\".concat(username)).catch(function () {\n                  _this.$router.replace({\n                    name: 'pages.not-found'\n                  });\n                });\n\n              case 3:\n                this.user = _context.sent;\n\n              case 4:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function getUser(_x) {\n        return _getUser.apply(this, arguments);\n      }\n\n      return getUser;\n    }(),\n    toggleStatus: function toggleStatus(timestamp) {\n      var _this2 = this;\n\n      this.user[timestamp] = this.user[timestamp] ? null : moment().format('YYYY-MM-DD HH:mm:ss');\n      this.$http.patch(\"users/\".concat(this.user.username), this.user).then(function () {\n        _this2.$message.success('搞定！');\n\n        _this2.getUser();\n      });\n    },\n    registerEventListener: function registerEventListener() {\n      var _this3 = this;\n\n      var vm = this;\n      window.addEventListener('scroll', function () {\n        if (vm.$route.name.substr(0, 5) === 'users') {\n          var top = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0;\n          _this3.navFixed = top >= document.querySelector('.user-show-navbar').offsetTop;\n        }\n      });\n    }\n  }\n};",{"version":3,"sources":["show.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div class=\"page-user-show\" v-if=\"user.id\">\n    <header\n      class=\"page-header d-flex align-items-end bg-grey-blue py-2\"\n      style=\"background-image: url(/banners/shanghai.jpg)\"\n    >\n      <div\n        class=\"user-profile container position-relative w-100 text-white p-2 d-md-flex flex-row align-items-center\"\n      >\n        <img :src=\"user.avatar\" alt=\"User avatar\" class=\"avatar avatar-120\">\n        <div class=\"ml-md-3\">\n          <h1 class=\"mt-2 mb-0\">\n            {{ user.name }}\n            <a\n              class=\"ml-md-1 d-block d-md-inline text-gray-90 text-16\"\n            >@{{ user.username }}</a>\n          </h1>\n          <div class=\"my-1\" v-if=\"!user.banned_at\">{{ user.bio }}</div>\n\n          <div class=\"extends text-white d-none d-md-block d-lg-flex\" v-if=\"!user.banned_at\">\n            <div class=\"mr-1\" v-if=\"user.extends.location\">\n              <map-marker-icon class=\"mr-1\"></map-marker-icon>\n              {{ user.extends.location }}\n            </div>\n            <div class=\"mr-1\" v-if=\"user.extends.company\">\n              <domain-icon class=\"mr-1\"></domain-icon>\n              {{ user.extends.company }}\n            </div>\n            <div class=\"mr-1\" v-if=\"user.extends.home_url\">\n              <link-icon class=\"mr-1\"></link-icon>\n              <a class=\"text-white\" :href=\"user.extends.home_url\">{{ user.extends.home_url }}</a>\n            </div>\n            <div class=\"mr-1\">\n              <calendar-check-icon class=\"mr-1\"></calendar-check-icon>\n              加入于 {{ user.created_at_timeago }}\n            </div>\n          </div>\n          <div class=\"pt-2\">\n            <user-social-btns :user=\"user\" :spacing=\"2\"></user-social-btns>\n          </div>\n        </div>\n        <template v-if=\"currentUser && currentUser.id != user.id && !user.banned_at\">\n          <follow-btn :item=\"user\" class=\"d-inline-block ml-md-auto\"></follow-btn>\n        </template>\n      </div>\n    </header>\n    <div class=\"user-show-navbar bg-white\">\n      <div class=\"container\">\n        <div class=\"nav nav-tab-line text-center shadow-6 align-items-stretch\">\n          <div class=\"nav-item\">\n            <router-link :to=\"{ name: 'users.show' }\" class=\"nav-link\" exact>最新动态</router-link>\n          </div>\n          <div class=\"nav-item\">\n            <router-link :to=\"{ name: 'users.threads' }\" class=\"nav-link\" exact>\n              讨论\n              <span class=\"text-gray-70 pl-1\">{{ user.cache.threads_count }}</span>\n            </router-link>\n          </div>\n          <!--<div class=\"nav-item\"><a href=\"#\" class=\"nav-link\">回复 234</a></div>-->\n          <div class=\"nav-item\">\n            <router-link :to=\"{ name: 'users.following' }\" class=\"nav-link\" exact>\n              关注\n              <span class=\"text-gray-70 pl-1\">{{ user.cache.followings_count }}</span>\n            </router-link>\n          </div>\n          <div class=\"nav-item\">\n            <router-link :to=\"{ name: 'users.followers' }\" class=\"nav-link\" exact>\n              粉丝\n              <span class=\"text-gray-70 pl-1\">{{ user.cache.followers_count }}</span>\n            </router-link>\n          </div>\n          <div class=\"nav-item ml-auto\" v-if=\"currentUser.is_admin\">\n            <div class=\"btn-group\">\n              <button\n                type=\"button\"\n                class=\"btn btn-link nav-link dropdown-toggle\"\n                data-toggle=\"dropdown\"\n                aria-haspopup=\"true\"\n                aria-expanded=\"false\"\n              >\n                <admin-icon/>管理\n              </button>\n              <div class=\"dropdown-menu dropdown-menu-right\">\n                <button\n                  class=\"dropdown-item\"\n                  type=\"button\"\n                  @click=\"toggleStatus('banned_at')\"\n                  :class=\"{'text-danger': !user.banned_at}\"\n                >\n                  <account-off-icon class=\"mr-1\"/>\n                  {{ user.banned_at ? '取消冻结' : '冻结' }}\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <div class=\"container pt-4\" v-if=\"!user.banned_at\">\n      <div class=\"row\">\n        <div class=\"col-lg-9\">\n          <router-view></router-view>\n        </div>\n        <div class=\"col-lg-3\">\n          <hot-tags></hot-tags>\n          <new-users class=\"mt-2\"></new-users>\n          <user-ranking class=\"mt-2\"></user-ranking>\n        </div>\n      </div>\n    </div>\n    <div class=\"container mt-4\" v-else>\n      <user-locked/>\n    </div>\n  </div>\n</template>\n\n<script>\nimport moment from 'moment'\nimport { mapGetters } from 'vuex'\nimport HotTags from '$components/hot-tags'\nimport UserRanking from '$components/user-ranking'\nimport NewUsers from '$components/new-users'\nimport FollowBtn from '$components/buttons/follow-btn'\nimport MapMarkerIcon from '$icons/MapMarker'\nimport DomainIcon from '$icons/Domain'\nimport LinkIcon from '$icons/Link'\nimport AccountOffIcon from '$icons/AccountOff'\nimport CalendarCheckIcon from '$icons/CalendarCheck'\nimport AdminIcon from '$icons/AccountTie'\nimport UserSocialBtns from '$components/user-social-btns'\nimport UserLocked from '$components/user-locked'\n\nexport default {\n  name: 'show',\n  components: {\n    UserLocked,\n    FollowBtn,\n    DomainIcon,\n    CalendarCheckIcon,\n    LinkIcon,\n    AdminIcon,\n    AccountOffIcon,\n    MapMarkerIcon,\n    HotTags,\n    UserRanking,\n    NewUsers,\n    UserSocialBtns\n  },\n  data () {\n    return {\n      user: {},\n      navFixed: false\n    }\n  },\n  computed: {\n    ...mapGetters(['currentUser'])\n  },\n  beforeRouteUpdate (to, from, next) {\n    if (to.params.username !== from.params.username) {\n      this.getUser(to.params.username)\n    }\n\n    next()\n  },\n  created () {\n    this.getUser(this.$route.params.username)\n    this.$nextTick(this.registerEventListener)\n  },\n  methods: {\n    async getUser (username) {\n      username = username || this.$route.params.username\n      this.user = await this.$http.get(`users/${username}`).catch(() => {\n        this.$router.replace({ name: 'pages.not-found' })\n      })\n    },\n    toggleStatus (timestamp) {\n      this.user[timestamp] = this.user[timestamp]\n        ? null\n        : moment().format('YYYY-MM-DD HH:mm:ss')\n      this.$http.patch(`users/${this.user.username}`, this.user).then(() => {\n        this.$message.success('搞定！')\n        this.getUser()\n      })\n    },\n    registerEventListener () {\n      let vm = this\n      window.addEventListener('scroll', () => {\n        if (vm.$route.name.substr(0, 5) === 'users') {\n          let top =\n            window.pageYOffset ||\n            document.documentElement.scrollTop ||\n            document.body.scrollTop ||\n            0\n\n          this.navFixed =\n            top >= document.querySelector('.user-show-navbar').offsetTop\n        }\n      })\n    }\n  }\n}\n</script>\n\n<style scoped lang=\"scss\">\n.page-user-show {\n  .bg-image {\n    overflow: hidden;\n\n    img {\n      width: 100%;\n      height: auto;\n    }\n  }\n  .page-header {\n    min-height: 40vh;\n    overflow-y: visible;\n    background-size: cover;\n    background-repeat: no-repeat;\n    background-position: center;\n  }\n  .user-show-navbar {\n    position: sticky;\n    top: -1px;\n    z-index: 999;\n    .nav {\n      position: relative;\n      background: transparent;\n      box-shadow: none;\n    }\n  }\n  .avatar {\n    border: 2px solid #fff;\n  }\n  .user-profile {\n    z-index: 2;\n    text-shadow: 1px 1px 10px #3d465e;\n  }\n\n  @media (max-width: 768px) {\n    .user-profile {\n      text-align: center;\n    }\n    .user-social-btns {\n      justify-content: center !important;\n    }\n  }\n}\n</style>\n"],"sourceRoot":"src/modules/users"}]}
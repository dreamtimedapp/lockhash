{"remainingRequest":"/root/lockhash/web-app/node_modules/thread-loader/dist/cjs.js!/root/lockhash/web-app/node_modules/babel-loader/lib/index.js!/root/lockhash/web-app/node_modules/eslint-loader/index.js??ref--13-0!/root/lockhash/web-app/src/components/editor/at-completer.js","dependencies":[{"path":"/root/lockhash/web-app/src/components/editor/at-completer.js","mtime":1553930101451},{"path":"/root/lockhash/web-app/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/root/lockhash/web-app/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/root/lockhash/web-app/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/root/lockhash/web-app/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.function.name\";\nimport \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"/root/lockhash/web-app/node_modules/@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport http from '$utils/http';\nimport CodeMirror from 'codemirror';\n\nrequire('codemirror/addon/hint/show-hint.css');\n\nrequire('codemirror/addon/hint/show-hint');\n\nrequire('codemirror/addon/hint/html-hint');\n\nvar emojiCompleter = function emojiCompleter(cm) {\n  var pageUsers = window['pageUsers'] || [];\n  CodeMirror.showHint(cm,\n  /*#__PURE__*/\n  _asyncToGenerator(\n  /*#__PURE__*/\n  regeneratorRuntime.mark(function _callee() {\n    var cur, token, start, end, line, currentWord, mapToList, users, filtered;\n    return regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            cur = cm.getCursor();\n            token = cm.getTokenAt(cur);\n            start = token.start;\n            end = cur.ch;\n            line = cur.line;\n            currentWord = token.string;\n\n            if (!(currentWord.indexOf('@') !== 0)) {\n              _context.next = 8;\n              break;\n            }\n\n            return _context.abrupt(\"return\", false);\n\n          case 8:\n            mapToList = function mapToList() {\n              var users = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n              var results = [];\n              pageUsers.concat(users).forEach(function (user) {\n                if (!results.some(function (o) {\n                  return o.text === user.username + ' ';\n                })) {\n                  results.push({\n                    text: user.username + ' ',\n                    render: function render(element) {\n                      element.innerHTML = \"<img style=\\\"width:1.2em;height: 1.2em;\\\" src=\\\"\".concat(user.avatar, \"\\\" alt=\\\"\").concat(user.name, \"\\\" async > \").concat(user.username);\n                    }\n                  });\n                }\n              });\n              return results;\n            };\n\n            if (!(currentWord === '@' && pageUsers.length > 0)) {\n              _context.next = 11;\n              break;\n            }\n\n            return _context.abrupt(\"return\", {\n              list: mapToList(),\n              from: CodeMirror.Pos(line, start + 1),\n              to: CodeMirror.Pos(line, end)\n            });\n\n          case 11:\n            if (!(currentWord.length >= 2)) {\n              _context.next = 20;\n              break;\n            }\n\n            _context.next = 14;\n            return http.get('users?query=' + currentWord.substring(1));\n\n          case 14:\n            users = _context.sent;\n\n            if (!(users.data.length >= 1)) {\n              _context.next = 18;\n              break;\n            }\n\n            filtered = mapToList(users.data);\n            return _context.abrupt(\"return\", {\n              list: filtered,\n              from: CodeMirror.Pos(line, start + 1),\n              to: CodeMirror.Pos(line, end)\n            });\n\n          case 18:\n            _context.next = 21;\n            break;\n\n          case 20:\n            return _context.abrupt(\"return\", false);\n\n          case 21:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  })), {\n    completeSingle: false\n  });\n};\n\nexport default emojiCompleter;",{"version":3,"sources":["/root/lockhash/web-app/src/components/editor/at-completer.js"],"names":["http","CodeMirror","require","emojiCompleter","cm","pageUsers","window","showHint","cur","getCursor","token","getTokenAt","start","end","ch","line","currentWord","string","indexOf","mapToList","users","results","concat","forEach","user","some","o","text","username","push","render","element","innerHTML","avatar","name","length","list","from","Pos","to","get","substring","data","filtered","completeSingle"],"mappings":"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","sourcesContent":["import http from '$utils/http'\nimport CodeMirror from 'codemirror'\n\nrequire('codemirror/addon/hint/show-hint.css')\nrequire('codemirror/addon/hint/show-hint')\nrequire('codemirror/addon/hint/html-hint')\n\nlet emojiCompleter = cm => {\n  let pageUsers = window['pageUsers'] || []\n\n  CodeMirror.showHint(\n    cm,\n    async () => {\n      let cur = cm.getCursor()\n      let token = cm.getTokenAt(cur)\n      let start = token.start\n      let end = cur.ch\n      let line = cur.line\n      let currentWord = token.string\n\n      if (currentWord.indexOf('@') !== 0) {\n        return false\n      }\n\n      let mapToList = (users = []) => {\n        let results = []\n        pageUsers.concat(users).forEach(user => {\n          if (!results.some(o => o.text === user.username + ' ')) {\n            results.push({\n              text: user.username + ' ',\n              render (element) {\n                element.innerHTML = `<img style=\"width:1.2em;height: 1.2em;\" src=\"${user.avatar}\" alt=\"${user.name}\" async > ${\n                  user.username\n                }`\n              }\n            })\n          }\n        })\n\n        return results\n      }\n\n      if (currentWord === '@' && pageUsers.length > 0) {\n        return {\n          list: mapToList(),\n          from: CodeMirror.Pos(line, start + 1),\n          to: CodeMirror.Pos(line, end)\n        }\n      }\n\n      if (currentWord.length >= 2) {\n        let users = await http.get('users?query=' + currentWord.substring(1))\n\n        if (users.data.length >= 1) {\n          let filtered = mapToList(users.data)\n\n          return {\n            list: filtered,\n            from: CodeMirror.Pos(line, start + 1),\n            to: CodeMirror.Pos(line, end)\n          }\n        }\n      } else {\n        return false\n      }\n    },\n    { completeSingle: false }\n  )\n}\n\nexport default emojiCompleter\n"]}]}
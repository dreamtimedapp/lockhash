(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-641b5dc0"],{"170d":function(t,e,n){"use strict";var i=n("581b"),a=n.n(i);a.a},"4668d":function(t,e,n){},"581b":function(t,e,n){},"8b73":function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.ready?n("div",{staticClass:"page-threads-show"},[t.currentUser.has_banned?n("div",[n("user-locked")],1):t.$user()&&!t.$user().has_activated?n("div",[n("div",{staticClass:"box-body py-4 text-center"},[n("h1",{staticClass:"display-4 text-gray-40"},[n("alert")],1),t._v("\n      您需要先激活账户以使用此功能\n    ")])]):n("div",{staticClass:"row"},[n("div",{staticClass:"col-md-9 m-auto"},[n("div",{staticClass:"box box-flush"},[n("form",[n("div",{staticClass:"card"},[n("div",{staticClass:"card-header pt-3 border-bottom-0"},[n("div",{staticClass:"input-group input-group"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.form.title,expression:"form.title"}],ref:"title_input",staticClass:"form-control form-control-lg",attrs:{type:"text",placeholder:"请在这里输入标题（请精准表达）"},domProps:{value:t.form.title},on:{input:function(e){e.target.composing||t.$set(t.form,"title",e.target.value)}}})])]),n("editor",{attrs:{toolbar:!1,options:{maxLines:1/0},placeholder:"请使用 Markdown 格式详细并精准的表达，不得少于30个字符~"},model:{value:t.form.content.markdown,callback:function(e){t.$set(t.form.content,"markdown",e)},expression:"form.content.markdown"}}),n("div",{staticClass:"card-footer border-top p-2 d-flex justify-content-between"},[n("div",{staticClass:"left-actions d-flex align-items-center"},[n("span",{staticClass:"text-muted"},[t._v("发布到")]),n("div",{staticClass:"dropdown ml-1"},[n("el-select",{attrs:{filterable:""},model:{value:t.form.node_id,callback:function(e){t.$set(t.form,"node_id",e)},expression:"form.node_id"}},t._l(t.nodes,function(t){return n("el-option",{key:t.id,attrs:{value:t.id,label:t.title}})}),1)],1)]),n("div",{staticClass:"right-actions"},[n("button",{staticClass:"btn btn-primary",attrs:{type:"button",disabled:!t.formReady},on:{click:function(e){return t.showCaptcha(!1)}}},[t._v("立即发布")]),n("button",{staticClass:"btn btn-secondary ml-1",attrs:{type:"button",disabled:!t.formReady},on:{click:function(e){return t.submit(!0)}}},[t._v("保存为草稿")])])])],1)])])])])]):t._e()},a=[],r=(n("f91a"),n("86c9")),o=n.n(r),s=n("71cb"),c=(n("3a23"),n("8e61")),l=n("52c1"),d=n("a0f0"),u=n("e9cc"),f=n("123e"),m=n.n(f),h=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("span",{staticClass:"material-design-icon alert-icon",attrs:{"aria-hidden":t.decorative,"aria-label":t.title,role:"img"},on:{click:function(e){return t.$emit("click",e)}}},[n("svg",{staticClass:"material-design-icon__svg",attrs:{fill:t.fillColor,width:t.size,height:t.size,viewBox:"0 0 24 24"}},[n("path",{attrs:{d:"M13,14H11V10H13M13,18H11V16H13M1,21H23L12,2L1,21Z"}},[n("title",[t._v(t._s(t.title))])])])])},p=[],v=(n("b06f"),{name:"AlertIcon",props:{title:{type:String,default:"Alert icon"},decorative:{type:Boolean,default:!1},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}}),b=v,g=n("17cc"),C=Object(g["a"])(b,h,p,!1,null,null,null),_=C.exports,y=n("54fe"),w=(n("4668d"),{name:"thread-form",components:{Editor:d["a"],Alert:_,ElSelect:y["Select"],ElOption:y["Option"],UserLocked:u["a"]},data:function(){return{ready:!1,nodes:[],busing:!1,form:{node_id:null,type:"markdown",is_draft:!0,title:"",content:{markdown:"",body:""},ticket:null,randstr:null}}},watch:{form:{deep:!0,handler:function(){m.a.setItem("thread.form",this.form)}}},computed:Object(c["a"])({},Object(l["c"])(["currentUser"]),{formReady:function(){return!this.busing&&this.form.title.length>=5&&this.form.node_id>0&&this.form.content.markdown&&this.form.content.markdown.length>=30}}),mounted:function(){var t=this;this.loadNodes(),"threads.edit"==this.$route.name?this.loadThread(this.$route.params.id).then(this.syncFromCache).then(function(){t.ready=!0}):(this.syncFromCache(),this.ready=!0),this.$nextTick(function(){t.$refs["title_input"].focus()})},methods:{syncFromCache:function(){var t=this;m.a.getItem("thread.form",function(e,n){e||"object"!==Object(s["a"])(n)||(t.form=o()(t.form,n))})},clearCache:function(){m.a.removeItem("thread.form")},loadNodes:function(){var t=this;return this.busing=!0,this.$http.get("nodes").then(function(e){t.nodes=e.data,t.busing=!1}).finally(function(){return t.busing=!1})},loadThread:function(t){var e=this;return this.$http.get("threads/".concat(t)).then(function(t){return e.form=o()(e.form,t)})},showCaptcha:function(t){var e=this,n=new TencentCaptcha("2079532902",function(n){if(0!==n.ret)return e.$message.error("请先完成验证！");e.form.ticket=n.ticket,e.form.randstr=n.randstr,e.submit(t)});n.show()},submit:function(){var t=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!this.form.ticket)return this.$message.error("请先完成验证！");this.form.is_draft=e,this.busing=!0;var n=null,i="threads.edit"==this.$route.name;n=i?this.$http.patch("threads/".concat(this.$route.params.id)).patch(this.form):this.$http.post("threads",this.form),n.then(function(n){t.$message.success("内容已"+(e?"保存为草稿":i?"更新":"发布")),t.$router.replace({name:"threads.show",params:{id:n.id}}),t.clearCache()}).finally(function(){return t.busing=!1})}}}),k=w,$=(n("170d"),Object(g["a"])(k,i,a,!1,null,null,null));e["default"]=$.exports},e9cc:function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"box text-center text-danger"},[n("h1",[n("account-off-icon")],1),t._v(" 该账户已被冻结\n")])},a=[],r=n("f759"),o={name:"user-locked",components:{AccountOffIcon:r["a"]}},s=o,c=n("17cc"),l=Object(c["a"])(s,i,a,!1,null,null,null);e["a"]=l.exports},f759:function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("span",{staticClass:"material-design-icon account-off-icon",attrs:{"aria-hidden":t.decorative,"aria-label":t.title,role:"img"},on:{click:function(e){return t.$emit("click",e)}}},[n("svg",{staticClass:"material-design-icon__svg",attrs:{fill:t.fillColor,width:t.size,height:t.size,viewBox:"0 0 24 24"}},[n("path",{attrs:{d:"M12,4C14.21,4 16,5.79 16,8C16,9.95 14.6,11.58 12.75,11.93L8.07,7.25C8.42,5.4 10.05,4 12,4M12.28,14L18.28,20L20,21.72L18.73,23L15.73,20H4V18C4,16.16 6.5,14.61 9.87,14.14L2.78,7.05L4.05,5.78L12.28,14M20,18V19.18L15.14,14.32C18,14.93 20,16.35 20,18Z"}},[n("title",[t._v(t._s(t.title))])])])])},a=[],r=(n("b06f"),{name:"AccountOffIcon",props:{title:{type:String,default:"Account Off icon"},decorative:{type:Boolean,default:!1},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}}),o=r,s=n("17cc"),c=Object(s["a"])(o,i,a,!1,null,null,null);e["a"]=c.exports}}]);
//# sourceMappingURL=chunk-641b5dc0.f5ab3aa5.js.map